
![لوگو مینی کانتینر](docs/mini-continer.png)

## نمای کلی
در این پروژه سعی شده است که پیاده‌سازی سبک یک کانتینر شبیه سازی شود که مفاهیم اصلی سیستم‌عامل را نشان می‌دهد شامل ایزولاسیون فرایند، مدیریت منابع و امنیت فایل‌سیستم.این سیستم به طور مستقیم با مکانیزم‌های هسته لینوکس تعامل می‌کند و از فراخوانی‌های سیستمی و رابط‌های هسته استفاده می‌کند.

## ویژگی‌های کلیدی
- **ایزولاسیون فرایند**: از فضای نام لینوکس استفاده می‌کند (PID, mount, UTS, network, user)
- **مدیریت منابع**: محدودیت‌های CPU و حافظه از طریق گروه‌های کنترل (cgroups)
- **ایزولاسیون فایل‌سیستم**: chroot و برای دسترسی امن فایل‌سیستم
- **چرخه حیات کانتینر**: عملیات ایجاد، شروع، توقف و نابودی کانتینر
- **رابط خط فرمان**: ابزارهای خط فرمان برای مدیریت کانتینر
![ویژگی‌های کلیدی](docs/imgs/dr0k22dr0k22dr0k.png)
## پیش‌نیازها
- **هسته لینوکس**: ۳.۸+ (برای پشتیبانی فضای نام)
- **کامپایلر سی‌پلاس‌پلاس**: GCC (g++) یا سازگار با پشتیبانی C++11
- **دسترسی روت**: برای عملیات کانتینر ضروری است
- **سی گروپ ها Cgroups**: در `/sys/fs/cgroup` mount شده
- **داکر Docker**: 20.10+
- **داکر کمپوز Docker Compose**: 1.29+
- **امتیازات sudo**: برای اجرای کانتینرهای privileged

### ساخت فایل های مربوط

```bash
git clone https://github.com/mroraie/mini-container.git
cd mini-container
make
# for installing the UI
make ui
```

```bash
# use this shell scripts
./deploy.sh
./deploy-dev.sh
```

## استفاده

### رابط گرافیکی ترمینال

```bash
./mini-container-ui
```

این رابط امکان مدیریت کانتینرها را با منوی گرافیکی فراهم می‌کند.
### دستورات پایه (خط فرمان)

```bash
# اجرای دستور در کانتینر
./mini-container run /bin/echo "Hello World"

# اجرای با محدودیت منابع
./mini-container run --memory 128 --cpu 512 /bin/sh

# لیست کانتینرها
./mini-container list

# دریافت اطلاعات کانتینر
./mini-container info container_id

# توقف کانتینر
./mini-container stop container_id

# نابودی کانتینر
./mini-container destroy container_id
```

## مفاهیم سیستم‌عامل نشان داده شده

### ۱. فضای نام لینوکس
- **فضای نام PID**: ایزولاسیون شناسه فرایند
- **فضای نام Mount**: ایزولاسیون فایل‌سیستم
- **فضای نام UTS**: ایزولاسیون نام میزبان
- **فضای نام Network**: ایزولاسیون پشته شبکه
- **فضای نام User**: ایزولاسیون شناسه کاربر/گروه

![فضاها](docs/imgs/namespace.png)
### ۲. گروه‌های کنترل (cgroups)
- **کنترل CPU**: مدیریت زمان‌بندی و سهمیه
- **کنترل حافظه**: محدودیت‌های RAM و swap


### ۳. امنیت فایل‌سیستم
- **chroot**: تغییر دایرکتوری ریشه
- **فضای نام Mount**: جداول mount خصوصی

### ۴. فراخوانی‌های سیستمی
- **clone()**: ایجاد فرایند با فضای نام
- **unshare()**: دستکاری فضای نام
- **mount()**: عملیات فایل‌سیستم
- **chroot()**: تغییرات دایرکتوری ریشه

## ساختار پروژه

```
mini-container/
├── src/                    # کد منبع
│   ├── main.cpp           # رابط CLI
│   ├── container_manager.cpp # چرخه حیات کانتینر
│   ├── namespace_handler.cpp # عملیات فضای نام
│   ├── resource_manager.cpp  # مدیریت Cgroup
│   ├── filesystem_manager.cpp # ایزولاسیون فایل‌سیستم
│   └── terminal_ui.cpp   # رابط گرافیکی ترمینال
├── include/               # فایل‌های سرآیند
├── tests/                 # اسکریپت‌های تست
├── examples/              # مثال‌های استفاده
├── docs/                  # مستندات
├── Dockerfile            # تنظیمات Docker
├── docker-compose.yml    # تنظیمات Docker Compose
├── deploy.sh            # اسکریپت استقرار
├── deploy-dev.sh        # اسکریپت استقرار توسعه
├── .dockerignore        # فایل‌های نادیده گرفته شده Docker
├── Makefile             # سیستم ساخت
└── README.md            # این فایل
```

## تست

تست‌های عملکرد پایه را اجرا کنید:

```bash
# تست‌های پایه
./tests/test_basic.sh

# تست‌های ایزولاسیون
./tests/test_isolation.sh
```

## مستندات

- **[گزارش فنی](docs/technical_report.md)**: توضیح مفصل مفاهیم سیستم‌عامل و پیاده‌سازی
- **[مثال‌ها](examples/README.md)**: سناریوهای استفاده و مثال‌ها
- **[مستندات API](docs/api.md)**: مرجع API داخلی

## نکات امنیتی

- **دسترسی روت**: اکثر عملیات نیاز به امتیازات روت دارند
- **هسته مشترک**: همه کانتینرها هسته را به اشتراک می‌گذارند
- **ایزولاسیون فضای نام**: ایزولاسیون سطح فرایند فراهم می‌کند
- **محدودیت منابع**: از طریق cgroups اعمال می‌شود

## تنظیمات Docker

### پیکربندی امنیتی

کانتینر Docker با امتیازات زیر اجرا می‌شود:
- `--privileged`: دسترسی کامل به دستگاه میزبان
- `--cap-add SYS_ADMIN`: قابلیت مدیریت سیستم
- `--cap-add NET_ADMIN`: قابلیت مدیریت شبکه
- `--security-opt apparmor:unconfined`: غیرفعال کردن AppArmor
- `--security-opt seccomp:unconfined`: غیرفعال کردن Seccomp

### Mount های ضروری

```yaml
volumes:
  - /sys/fs/cgroup:/sys/fs/cgroup:rw  # برای cgroups
  - /tmp:/tmp:rw                      # برای فایل‌های موقت
```

## محدودیت‌ها

- **فرایند تکی**: هر کانتینر یک فرایند اصلی اجرا می‌کند
- **بدون مدیریت ایمیج**: تنظیم فایل‌سیستم دستی ضروری است
- **شبکه پایه**: پشتیبانی فضای نام شبکه حداقل است
- **بدون ماندگاری**: کانتینرها ریبوت را تحمل نمی‌کنند

## مقایسه با داکر

| ویژگی            | مینی کانتینر      | داکر                           |
| ---------------- | ----------------- | ------------------------------ |
| **ایزولاسیون**   | فضای نام هسته     | فضای نام هسته + لایه‌های اضافی |
| **مدیریت منابع** | cgroups           | cgroups + کنترل‌های اضافی      |
| **فایل‌سیستم**   | chroot/pivot_root | فایل‌سیستم لایه‌ای + overlay   |
| **شبکه**         | فضای نام پایه     | شبکه پیشرفته                   |
| **ایمیج‌ها**     | تنظیم دستی        | لایه‌های ایمیج + registry      |
| **پیچیدگی**      | حداقل             | کامل‌ویژگی                     |
