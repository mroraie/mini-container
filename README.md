# سیستم مینی کانتینر

![لوگو مینی کانتینر](docs/mini-continer.png)

پیاده‌سازی سبک کانتینر که مفاهیم اصلی سیستم‌عامل را نشان می‌دهد شامل ایزولاسیون فرایند، مدیریت منابع و امنیت فایل‌سیستم.

## نمای کلی

این پروژه سیستم مینی کانتینر مشابه داکر را پیاده‌سازی می‌کند که به عنوان پروژه درس سیستم‌عامل طراحی شده است. بر خلاف داکر، این سیستم به طور مستقیم با مکانیزم‌های هسته لینوکس تعامل می‌کند و از فراخوانی‌های سیستمی و رابط‌های هسته استفاده می‌کند.

## ویژگی‌های کلیدی

- **ایزولاسیون فرایند**: از فضای نام لینوکس استفاده می‌کند (PID, mount, UTS, network, user)
- **مدیریت منابع**: محدودیت‌های CPU و حافظه از طریق گروه‌های کنترل (cgroups)
- **ایزولاسیون فایل‌سیستم**: chroot و pivot_root برای دسترسی امن فایل‌سیستم
- **چرخه حیات کانتینر**: عملیات ایجاد، شروع، توقف و نابودی کانتینر
- **رابط خط فرمان**: ابزارهای خط فرمان برای مدیریت کانتینر

## معماری

```
┌─────────────────┐
│ رابط خط فرمان   │
└─────────┬───────┘
          │
┌─────────▼────────┐
│مدیریت‌کننده     │
│   کانتینر       │
├─────────┬────────┤
│مدیریت   │ مدیریت│
│منابع    │ فایل   │
│         │ سیستم │
├─────────┼────────┤
│ مدیریت  │        │
│فضای نام │        │
└─────────┴────────┘
```

## پیش‌نیازها

- **هسته لینوکس**: ۳.۸+ (برای پشتیبانی فضای نام)
- **کامپایلر سی‌پلاس‌پلاس**: GCC (g++) یا سازگار با پشتیبانی C++11
- **دسترسی روت**: برای عملیات کانتینر ضروری است
- **Cgroups**: در `/sys/fs/cgroup` mount شده

## ساخت

```bash
# Clone یا به دایرکتوری پروژه بروید
cd mini-container

# سیستم را بسازید
make

# یا برای ساخت رابط گرافیکی ترمینال:
make ui

# اختیاری: نصب در کل سیستم
sudo make install
```

## استفاده

### رابط گرافیکی ترمینال

برای تجربه کاربری بهتر، از رابط گرافیکی ترمینال استفاده کنید:

```bash
# اجرای رابط گرافیکی ترمینال (لینوکس)
./mini-container-ui

# یا روی ویندوز برای نمایش دمو:
./mini-container-ui.exe
```

این رابط امکان مدیریت کانتینرها را با منوی گرافیکی فراهم می‌کند. نسخه ویندوز به صورت دمو عمل می‌کند و عملکرد واقعی کانتینر را شبیه‌سازی می‌کند.

برای مشاهده اطلاعات بیشتر درباره رابط گرافیکی:
```bash
./demo_ui.sh
```

### دستورات پایه (خط فرمان)

```bash
# اجرای دستور در کانتینر
./mini-container run /bin/echo "Hello World"

# اجرای با محدودیت منابع
./mini-container run --memory 128 --cpu 512 /bin/sh

# لیست کانتینرها
./mini-container list

# دریافت اطلاعات کانتینر
./mini-container info container_id

# توقف کانتینر
./mini-container stop container_id

# نابودی کانتینر
./mini-container destroy container_id
```

### استفاده پیشرفته

```bash
# نام میزبان سفارشی
./mini-container run --hostname "my-container" /bin/hostname

# فایل‌سیستم ریشه سفارشی
./mini-container run --root /path/to/rootfs /bin/sh

# فعال‌سازی ایزولاسیون شبکه
./mini-container run --network /bin/sh

# فعال‌سازی فضای نام کاربر
./mini-container run --user /bin/sh
```

## مفاهیم سیستم‌عامل نشان داده شده

### ۱. فضای نام لینوکس
- **فضای نام PID**: ایزولاسیون شناسه فرایند
- **فضای نام Mount**: ایزولاسیون فایل‌سیستم
- **فضای نام UTS**: ایزولاسیون نام میزبان
- **فضای نام Network**: ایزولاسیون پشته شبکه
- **فضای نام User**: ایزولاسیون شناسه کاربر/گروه

### ۲. گروه‌های کنترل (cgroups)
- **کنترل CPU**: مدیریت زمان‌بندی و سهمیه
- **کنترل حافظه**: محدودیت‌های RAM و swap
- **حسابداری منابع**: ردیابی استفاده از منابع

### ۳. امنیت فایل‌سیستم
- **chroot**: تغییر دایرکتوری ریشه
- **pivot_root**: تعویض ریشه پیشرفته
- **فضای نام Mount**: جداول mount خصوصی

### ۴. فراخوانی‌های سیستمی
- **clone()**: ایجاد فرایند با فضای نام
- **unshare()**: دستکاری فضای نام
- **mount()**: عملیات فایل‌سیستم
- **chroot()**: تغییرات دایرکتوری ریشه

## ساختار پروژه

```
mini-container/
├── src/                    # کد منبع
│   ├── main.cpp           # رابط CLI
│   ├── container_manager.cpp # چرخه حیات کانتینر
│   ├── namespace_handler.cpp # عملیات فضای نام
│   ├── resource_manager.cpp  # مدیریت Cgroup
│   └── filesystem_manager.cpp # ایزولاسیون فایل‌سیستم
├── include/               # فایل‌های سرآیند
├── tests/                 # اسکریپت‌های تست
├── examples/              # مثال‌های استفاده
├── docs/                  # مستندات
├── Makefile              # سیستم ساخت
└── README.md             # این فایل
```

## تست

تست‌های عملکرد پایه را اجرا کنید:

```bash
# تست‌های پایه
./tests/test_basic.sh

# تست‌های ایزولاسیون
./tests/test_isolation.sh
```

## مستندات

- **[گزارش فنی](docs/technical_report.md)**: توضیح مفصل مفاهیم سیستم‌عامل و پیاده‌سازی
- **[مثال‌ها](examples/README.md)**: سناریوهای استفاده و مثال‌ها
- **[مستندات API](docs/api.md)**: مرجع API داخلی

## نکات امنیتی

- **روت ضروری**: اکثر عملیات نیاز به امتیازات روت دارند
- **هسته مشترک**: همه کانتینرها هسته میزبان را به اشتراک می‌گذارند
- **ایزولاسیون فضای نام**: ایزولاسیون سطح فرایند فراهم می‌کند
- **محدودیت منابع**: از طریق cgroups اعمال می‌شود

## محدودیت‌ها

- **فرایند تکی**: هر کانتینر یک فرایند اصلی اجرا می‌کند
- **بدون مدیریت ایمیج**: تنظیم فایل‌سیستم دستی ضروری است
- **شبکه پایه**: پشتیبانی فضای نام شبکه حداقل است
- **بدون ماندگاری**: کانتینرها ریبوت را تحمل نمی‌کنند

## مقایسه با داکر

| ویژگی | مینی کانتینر | داکر |
|--------|--------------|-------|
| **ایزولاسیون** | فضای نام هسته | فضای نام هسته + لایه‌های اضافی |
| **مدیریت منابع** | cgroups | cgroups + کنترل‌های اضافی |
| **فایل‌سیستم** | chroot/pivot_root | فایل‌سیستم لایه‌ای + overlay |
| **شبکه** | فضای نام پایه | شبکه پیشرفته |
| **ایمیج‌ها** | تنظیم دستی | لایه‌های ایمیج + registry |
| **پیچیدگی** | حداقل | کامل‌ویژگی |

## ارزش آموزشی

این پروژه نشان می‌دهد:
- رابط‌های سطح پایین هسته سیستم‌عامل
- مکانیزم‌های ایزولاسیون فرایند
- تکنیک‌های مدیریت منابع
- الگوهای استفاده از فراخوانی‌های سیستمی
- اصول پایه کانتینری‌سازی

## بهبودهای آینده

- سیستم مدیریت ایمیج
- شبکه پیشرفته
- checkpoint/restore کانتینر
- ویژگی‌های امنیتی پیشرفته
- کانتینرهای چندفرایندی

## مجوز

این پروژه برای اهداف آموزشی به عنوان بخشی از درس سیستم‌عامل توسعه داده شده است.

## مشارکت

این پروژه آموزشی است. برای بهبودها، موارد زیر را در نظر بگیرید:
- افزودن انواع فضای نام بیشتر
- پیاده‌سازی شبکه پیشرفته
- بهبود ویژگی‌های امنیتی
- افزودن تست جامع

---

**نکته**: این پیاده‌سازی ساده‌سازی شده برای اهداف آموزشی است. استفاده عملیاتی نیاز به اقدامات امنیتی اضافی، تست و ویژگی‌هایی دارد که در سیستم‌های کانتینر成熟 مانند داکر یا پادمن یافت می‌شود.
